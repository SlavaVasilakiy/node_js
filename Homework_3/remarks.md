Функции не должны зависеть от внешних переменных (у Вас это viewCounters). Если нужны данные "снаружи", то их нужно передавать на вход в функцию